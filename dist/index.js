import{defineInterface as e}from"@directus/extensions-sdk";import{defineComponent as t,ref as a,resolveComponent as n,openBlock as i,createBlock as l,withCtx as o,createVNode as d,createSlots as s,createElementBlock as u,Fragment as r,renderList as c,createTextVNode as f,toDisplayString as p,createCommentVNode as m,nextTick as v}from"vue";var h=t({__name:"interface",props:{token:{type:String,default:""},rate:{type:[Number,String],default:300},value:{type:String,default:""},placeholder:{type:String,default:null},iconLeft:{type:String,default:null},iconRight:{type:String,default:null},disabled:{type:Boolean,default:!1},direction:{type:String,default:void 0}},emits:["input","set-field-value"],setup(e,{emit:t}){const h=e,g=a([]),y={method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Token "+h.token}};const _=function(e,t){let a;return function(...n){const i=this;clearTimeout(a),a=setTimeout((()=>e.apply(i,n)),t)}}((async function(e){var t;if(e.length<3)g.value=[];else try{const a=await fetch("https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/party",Object.assign(y,{body:JSON.stringify({query:e})})),n=await a.json();g.value=null!==(t=null==n?void 0:n.suggestions)&&void 0!==t?t:[]}catch(e){console.error(e)}}),Number(h.rate));function b(e){e=(null==e?void 0:e.trim())||"",t("input",e),_(e)}return(a,h)=>{const y=n("v-icon"),_=n("v-input"),k=n("v-list-item-content"),w=n("v-list-item"),S=n("v-list"),$=n("v-menu");return i(),l($,{attached:"",disabled:e.disabled},{activator:o((({activate:t})=>[d(_,{placeholder:e.placeholder,disabled:e.disabled,"model-value":e.value,dir:e.direction,"onUpdate:modelValue":b,onFocus:t},s({_:2},[e.iconLeft?{name:"prepend",fn:o((()=>[d(y,{name:e.iconLeft},null,8,["name"])]))}:void 0,e.iconRight?{name:"append",fn:o((()=>[d(y,{name:e.iconRight},null,8,["name"])]))}:void 0]),1032,["placeholder","disabled","model-value","dir","onFocus"])])),default:o((()=>[g.value.length>0?(i(),l(S,{key:0},{default:o((()=>[(i(!0),u(r,null,c(g.value,(e=>(i(),l(w,{key:e.data.inn,onClick:()=>async function(e){const a=e.data,n=["inn","kpp","ogrn","okpo"];for(const e of n)t("set-field-value",{field:e,value:a[e]}),await v();t("set-field-value",{field:"name",value:a.name.full}),await v(),t("set-field-value",{field:"opf",value:a.opf.full}),await v(),t("set-field-value",{field:"address",value:a.address.unrestricted_value}),await v()}(e)},{default:o((()=>[d(k,null,{default:o((()=>[f("ИНН: "+p(e.data.inn)+", "+p(e.value),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):m("v-if",!0)])),_:1},8,["disabled"])}}});h.__file="src/interface.vue";var g=e({id:"dadata",name:"DaData",description:"",icon:"find_in_page",component:h,types:["string"],options:[{field:"token",name:"$t:Токен",meta:{interface:"input",options:{font:"monospace"},width:"full"}},{field:"rate",name:"$t:Задержка запроса",type:"integer",schema:{default_value:300},meta:{width:"half",interface:"input"}},{field:"placeholder",name:"$t:placeholder",meta:{width:"half",interface:"system-input-translated-string",options:{placeholder:"$t:enter_a_placeholder"}}},{field:"iconLeft",name:"$t:icon_left",type:"string",meta:{width:"half",interface:"select-icon"}},{field:"iconRight",name:"$t:icon_right",type:"string",meta:{width:"half",interface:"select-icon"}}]});export{g as default};
