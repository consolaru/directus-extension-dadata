import{defineInterface as e}from"@directus/extensions-sdk";import{defineComponent as t,ref as a,resolveComponent as n,openBlock as i,createBlock as l,withCtx as o,createVNode as d,createSlots as s,createElementBlock as u,Fragment as r,renderList as c,createTextVNode as f,toDisplayString as p,createCommentVNode as v,nextTick as m}from"vue";var g=t({__name:"interface",props:{token:{type:String,default:""},entity:{type:String,default:"org"},rate:{type:[Number,String],default:300},value:{type:String,default:""},placeholder:{type:String,default:null},iconLeft:{type:String,default:null},iconRight:{type:String,default:null},disabled:{type:Boolean,default:!1},direction:{type:String,default:void 0}},emits:["input","set-field-value"],setup(e,{emit:t}){const g=e,h=a([]),y="bank"===g.entity?"https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/bank":"https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/party",_={method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Token "+g.token}};const k=function(e,t){let a;return function(...n){const i=this;clearTimeout(a),a=setTimeout((()=>e.apply(i,n)),t)}}((async function(e){var t;if(e.length<3)h.value=[];else try{const a=await fetch(y,Object.assign(_,{body:JSON.stringify({query:e})})),n=await a.json();h.value=null!==(t=null==n?void 0:n.suggestions)&&void 0!==t?t:[]}catch(e){console.error(e)}}),Number(g.rate));function b(e){e=(null==e?void 0:e.trim())||"",t("input",e),k(e)}async function w(e){"bank"===g.entity?await async function(e){const a=e.data;t("set-field-value",{field:"bik",value:a.bic}),await m(),t("set-field-value",{field:"bank_name",value:a.name.short}),await m(),t("set-field-value",{field:"kor_acc",value:a.correspondent_account})}(e):await async function(e){const a=e.data,n=["inn","kpp","ogrn","okpo"];for(const e of n)t("set-field-value",{field:e,value:a[e]}),await m();t("set-field-value",{field:"name",value:a.name.short}),await m(),t("set-field-value",{field:"opf",value:a.opf.short}),await m(),t("set-field-value",{field:"address",value:a.address.unrestricted_value})}(e)}return(t,a)=>{const m=n("v-icon"),y=n("v-input"),_=n("v-list-item-content"),k=n("v-list-item"),S=n("v-list"),$=n("v-menu");return i(),l($,{attached:"",disabled:e.disabled},{activator:o((({activate:t})=>[d(y,{placeholder:e.placeholder,disabled:e.disabled,"model-value":e.value,dir:e.direction,"onUpdate:modelValue":b,onFocus:t},s({_:2},[e.iconLeft?{name:"prepend",fn:o((()=>[d(m,{name:e.iconLeft},null,8,["name"])]))}:void 0,e.iconRight?{name:"append",fn:o((()=>[d(m,{name:e.iconRight},null,8,["name"])]))}:void 0]),1032,["placeholder","disabled","model-value","dir","onFocus"])])),default:o((()=>[h.value.length>0?(i(),l(S,{key:0},{default:o((()=>[(i(!0),u(r,null,c(h.value,(e=>(i(),l(k,{key:e.data.inn,onClick:()=>w(e)},{default:o((()=>["bank"===g.entity?(i(),l(_,{key:0},{default:o((()=>[f(p(e.value),1)])),_:2},1024)):(i(),l(_,{key:1},{default:o((()=>[f("ИНН: "+p(e.data.inn)+", "+p(e.value),1)])),_:2},1024))])),_:2},1032,["onClick"])))),128))])),_:1})):v("v-if",!0)])),_:1},8,["disabled"])}}});g.__file="src/interface.vue";var h=e({id:"dadata",name:"DaData",description:"",icon:"find_in_page",component:g,types:["string"],options:[{field:"token",name:"$t:Токен",meta:{interface:"input",options:{font:"monospace"},width:"full"}},{field:"entity",name:"$t:Тип",type:"string",schema:{default_value:"org"},meta:{width:"half",interface:"select-dropdown",options:{choices:[{text:"Организация",value:"org"},{text:"Банк",value:"bank"}]}}},{field:"rate",name:"$t:Задержка запроса",type:"integer",schema:{default_value:300},meta:{width:"half",interface:"input"}},{field:"iconLeft",name:"$t:icon_left",type:"string",meta:{width:"half",interface:"select-icon"}},{field:"iconRight",name:"$t:icon_right",type:"string",meta:{width:"half",interface:"select-icon"}},{field:"placeholder",name:"$t:placeholder",meta:{width:"half",interface:"system-input-translated-string",options:{placeholder:"$t:enter_a_placeholder"}}}]});export{h as default};
