import{defineInterface as e}from"@directus/extensions-sdk";import{defineComponent as t,ref as n,resolveComponent as a,openBlock as i,createBlock as l,withCtx as o,createVNode as d,createSlots as r,createElementBlock as s,Fragment as c,renderList as u,createTextVNode as p,toDisplayString as f,createCommentVNode as m,nextTick as h}from"vue";var v=t({__name:"interface",props:{token:{type:String,default:""},rate:{type:[Number,String],default:300},value:{type:String,default:""},placeholder:{type:String,default:null},iconLeft:{type:String,default:null},iconRight:{type:String,default:null},disabled:{type:Boolean,default:!1},direction:{type:String,default:void 0}},emits:["input","set-field-value"],setup(e,{emit:t}){const v=e,g=n([]),y={method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Token "+v.token}};const _=function(e,t){let n;return function(...a){const i=this;clearTimeout(n),n=setTimeout((()=>e.apply(i,a)),t)}}((async function(e){var t;if(e)try{const n=await fetch("https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/party",Object.assign(y,{body:JSON.stringify({query:e})})),a=await n.json();g.value=null!==(t=null==a?void 0:a.suggestions)&&void 0!==t?t:[]}catch(e){console.error(e)}else g.value=[]}),Number(v.rate));function b(e){e=e.trim(),t("input",e),_(e)}return(n,v)=>{const y=a("v-icon"),_=a("v-input"),k=a("v-list-item-content"),S=a("v-list-item"),w=a("v-list"),$=a("v-menu");return i(),l($,{attached:"",disabled:e.disabled},{activator:o((({activate:t})=>[d(_,{placeholder:e.placeholder,disabled:e.disabled,"model-value":e.value,dir:e.direction,"onUpdate:modelValue":b,onFocus:t},r({_:2},[e.iconLeft?{name:"prepend",fn:o((()=>[d(y,{name:e.iconLeft},null,8,["name"])]))}:void 0,e.iconRight?{name:"append",fn:o((()=>[d(y,{name:e.iconRight},null,8,["name"])]))}:void 0]),1032,["placeholder","disabled","model-value","dir","onFocus"])])),default:o((()=>[g.value.length>0?(i(),l(w,{key:0},{default:o((()=>[(i(!0),s(c,null,u(g.value,(e=>(i(),l(S,{key:e.data.inn,onClick:()=>async function(e){const n=["kpp","ogrn","okpo"];for(const a of n)t("set-field-value",{field:a,value:e.data[a]}),await h();t("input",e.data.inn)}(e)},{default:o((()=>[d(k,null,{default:o((()=>[p(f(e.value),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):m("v-if",!0)])),_:1},8,["disabled"])}}});v.__file="src/interface.vue";var g=e({id:"dadata",name:"DaData",description:"",icon:"find_in_page",component:v,types:["string"],options:[{field:"token",name:"$t:Токен",meta:{interface:"input",options:{font:"monospace"},width:"full"}},{field:"rate",name:"$t:Задержка запроса",type:"integer",schema:{default_value:300},meta:{width:"half",interface:"input"}},{field:"placeholder",name:"$t:placeholder",meta:{width:"half",interface:"system-input-translated-string",options:{placeholder:"$t:enter_a_placeholder"}}},{field:"iconLeft",name:"$t:icon_left",type:"string",meta:{width:"half",interface:"select-icon"}},{field:"iconRight",name:"$t:icon_right",type:"string",meta:{width:"half",interface:"select-icon"}}]});export{g as default};
